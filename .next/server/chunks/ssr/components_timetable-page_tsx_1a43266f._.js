module.exports=[45117,a=>{"use strict";var b=a.i(96974),c=a.i(16590),d=a.i(3130),e=a.i(40695),f=a.i(54161),g=a.i(5522),h=a.i(76929),i=a.i(3803),j=a.i(26345),k=a.i(75407),l=a.i(11374),m=a.i(7085),n=a.i(61237);let o=(0,n.default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),p=(0,n.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var q=a.i(1556),r=a.i(69964);let s=(0,n.default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var t=a.i(84435);let u=(0,n.default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),v=(0,n.default)("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);var w=a.i(73608),x=a.i(55005),y=a.i(69240),z=a.i(87682),A=a.i(21958),B=a.i(19260);function C({date:a,initialBookings:n,shopId:C,workingHours:D={start:"09:00",end:"17:00"},slotDuration:E=30}){let F=(0,x.useRouter)(),[G,H]=(0,c.useState)(n),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)("all"),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(new Date),[S,T]=(0,c.useState)("calendar");(0,c.useEffect)(()=>{let a=setInterval(()=>{R(new Date)},6e4);return()=>clearInterval(a)},[]),(0,c.useEffect)(()=>{let b=(0,y.createClient)(),c=b.channel("timetable-bookings-changes").on("postgres_changes",{event:"*",schema:"public",table:"bookings",filter:`shop_id=eq.${C}`},b=>{if("INSERT"===b.eventType){let c=b.new;c.appointment_date===a&&H(a=>a.find(a=>a.id===c.id)?a:[...a,c].sort((a,b)=>{let c=a.appointment_time.split(":").map(Number),d=b.appointment_time.split(":").map(Number);return 60*c[0]+c[1]-(60*d[0]+d[1])}))}else if("UPDATE"===b.eventType){let c=b.new;c.appointment_date===a?H(a=>a.map(a=>a.id===c.id?c:a)):H(a=>a.filter(a=>a.id!==c.id))}else"DELETE"===b.eventType&&H(a=>a.filter(a=>a.id!==b.old.id))}).subscribe();return()=>{b.removeChannel(c)}},[C,a]);let U=async(a,b)=>{N(a);try{if(!(await fetch(`/api/bookings/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:b})})).ok)throw Error("Failed to update booking");F.refresh()}catch(a){console.error("Error updating booking:",a),alert("Failed to update booking status")}finally{N(null)}},V=async a=>{P(a);try{if(!(await fetch(`/api/bookings/${a}/notify`,{method:"POST"})).ok)throw Error("Failed to send notification");alert("Notification email sent successfully!")}catch(a){console.error("Error sending notification:",a),alert("Failed to send notification email")}finally{P(null)}},W=a=>{switch(a){case"confirmed":return"bg-green-500/10 text-green-700 dark:text-green-400 border-green-300";case"completed":return"bg-blue-500/10 text-blue-700 dark:text-blue-400 border-blue-300";case"cancelled":return"bg-red-500/10 text-red-700 dark:text-red-400 border-red-300";default:return"bg-yellow-500/10 text-yellow-700 dark:text-yellow-400 border-yellow-300"}},X=G.filter(a=>{let b=a.user_name.toLowerCase().includes(I.toLowerCase())||a.user_email.toLowerCase().includes(I.toLowerCase())||a.user_phone&&a.user_phone.includes(I)||a.appointment_time.includes(I),c="all"===K||a.status===K;return b&&c}),Y=(()=>{let a=[],[b,c]=D.start.split(":").map(Number),[d,e]=D.end.split(":").map(Number),f=b,g=c;for(;f<d||f===d&&g<e;)a.push(`${f.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`),(g+=E)>=60&&(g=0,f++);return a})(),Z=()=>{if(a!==(0,w.format)(new Date,"yyyy-MM-dd"))return null;let b=60*Q.getHours()+Q.getMinutes(),[c,d]=D.start.split(":").map(Number),e=60*c+d,[f,g]=D.end.split(":").map(Number),h=60*f+g;return b<e||b>=h?null:(b-e)/(h-e)*100},$={total:G.length,pending:G.filter(a=>"pending"===a.status).length,confirmed:G.filter(a=>"confirmed"===a.status).length,completed:G.filter(a=>"completed"===a.status).length,cancelled:G.filter(a=>"cancelled"===a.status).length};return(0,c.useEffect)(()=>{G.length>0&&(console.log("Bookings data:",G),console.log("Time slots:",Y),console.log("Working hours:",D))},[G,Y,D]),(0,b.jsxs)("div",{className:"container mx-auto max-w-7xl px-3 sm:px-4 py-4 sm:py-8",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)(B.default,{href:"/shop/bookings",className:"mb-4 inline-flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,b.jsx)(l.ArrowLeft,{className:"h-4 w-4"}),"Back to Bookings"]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"mb-2 text-2xl sm:text-3xl font-bold",children:"Timetable"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(q.Calendar,{className:"h-4 w-4 sm:h-5 sm:w-5"}),(0,b.jsx)("span",{className:"text-base sm:text-lg",children:(0,w.format)(new Date(a),"EEEE, MMMM d, yyyy")})]})]}),(0,b.jsxs)(e.Button,{onClick:()=>{let b=new Blob([["Time,Customer Name,Email,Phone,Status,Notes",...X.map(a=>[a.appointment_time,a.user_name,a.user_email,a.user_phone||"",a.status,a.notes||""]).map(a=>a.map(a=>`"${a}"`).join(","))].join("\n")],{type:"text/csv"}),c=window.URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`bookings-${a}.csv`,d.click(),window.URL.revokeObjectURL(c)},variant:"outline",className:"gap-2 w-full sm:w-auto",children:[(0,b.jsx)(p,{className:"h-4 w-4"}),"Export CSV"]})]})]}),(0,b.jsxs)("div",{className:"mb-6 grid gap-3 sm:gap-4 grid-cols-2 md:grid-cols-5",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2 sm:pb-3",children:(0,b.jsx)(d.CardTitle,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Total"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-xl sm:text-2xl font-bold",children:$.total})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2 sm:pb-3",children:(0,b.jsx)(d.CardTitle,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Pending"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-xl sm:text-2xl font-bold text-yellow-600",children:$.pending})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2 sm:pb-3",children:(0,b.jsx)(d.CardTitle,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Confirmed"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:$.confirmed})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2 sm:pb-3",children:(0,b.jsx)(d.CardTitle,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Completed"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:$.completed})})]}),(0,b.jsxs)(d.Card,{className:"col-span-2 md:col-span-1",children:[(0,b.jsx)(d.CardHeader,{className:"pb-2 sm:pb-3",children:(0,b.jsx)(d.CardTitle,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Cancelled"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-xl sm:text-2xl font-bold text-red-600",children:$.cancelled})})]})]}),(0,b.jsx)(d.Card,{className:"mb-6",children:(0,b.jsx)(d.CardContent,{className:"pt-4 sm:pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4 md:flex-row",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search by name, email, phone, or time...",value:I,onChange:a=>J(a.target.value),className:"pl-10 text-sm sm:text-base"})]}),(0,b.jsxs)(z.Select,{value:K,onValueChange:L,children:[(0,b.jsxs)(z.SelectTrigger,{className:"w-full md:w-[200px]",children:[(0,b.jsx)(o,{className:"mr-2 h-4 w-4"}),(0,b.jsx)(z.SelectValue,{placeholder:"Filter by status"})]}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"all",children:"All Statuses"}),(0,b.jsx)(z.SelectItem,{value:"pending",children:"Pending"}),(0,b.jsx)(z.SelectItem,{value:"confirmed",children:"Confirmed"}),(0,b.jsx)(z.SelectItem,{value:"completed",children:"Completed"}),(0,b.jsx)(z.SelectItem,{value:"cancelled",children:"Cancelled"})]})]})]})})}),(0,b.jsxs)(A.Tabs,{value:S,onValueChange:a=>T(a),className:"mb-6",children:[(0,b.jsxs)(A.TabsList,{className:"w-full sm:w-fit",children:[(0,b.jsxs)(A.TabsTrigger,{value:"calendar",className:"flex-1 sm:flex-initial",children:[(0,b.jsx)(q.Calendar,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Calendar View"}),(0,b.jsx)("span",{className:"sm:hidden",children:"Calendar"})]}),(0,b.jsxs)(A.TabsTrigger,{value:"list",className:"flex-1 sm:flex-initial",children:[(0,b.jsx)(v,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"List View"}),(0,b.jsx)("span",{className:"sm:hidden",children:"List"})]})]}),(0,b.jsx)(A.TabsContent,{value:"calendar",className:"mt-6",children:(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"p-0 overflow-x-auto",children:(0,b.jsxs)("div",{className:"relative min-w-full",children:[null!==Z()&&(0,b.jsxs)("div",{className:"absolute left-0 right-0 z-10 flex items-center",style:{top:`${Z()}%`},children:[(0,b.jsx)("div",{className:"h-0.5 w-full bg-red-500"}),(0,b.jsx)("div",{className:"absolute right-0 rounded-full bg-red-500 px-2 py-0.5 text-xs font-semibold text-white",children:(0,w.format)(Q,"HH:mm")})]}),(0,b.jsx)("div",{className:"divide-y min-w-full",children:Y.map((c,g)=>{let h,i,l=(i=(h=a=>a.split(":").slice(0,2).join(":"))(c),G.filter(a=>h(a.appointment_time)===i)),m=(b=>{if(a!==(0,w.format)(new Date,"yyyy-MM-dd"))return!1;let[c,d]=b.split(":").map(Number),e=Q.getHours(),f=Q.getMinutes(),g=60*c+d,h=60*e+f;return h>=g&&h<g+E})(c),n=l.filter(a=>{if(!I&&"all"===K)return!0;let b=!I||a.user_name.toLowerCase().includes(I.toLowerCase())||a.user_email.toLowerCase().includes(I.toLowerCase())||a.user_phone&&a.user_phone.includes(I)||a.appointment_time.includes(I),c="all"===K||a.status===K;return b&&c});return(0,b.jsx)("div",{className:`relative min-h-[120px] p-3 sm:p-4 transition-colors ${m?"bg-red-50 dark:bg-red-950/20":"hover:bg-accent/50"} ${g%2==0?"bg-background":"bg-muted/30"}`,children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{className:"w-full sm:w-20 flex-shrink-0",children:[(0,b.jsx)("div",{className:`text-base sm:text-lg font-semibold ${m?"text-red-600":""}`,children:c}),m&&(0,b.jsx)("div",{className:"mt-1 text-xs text-red-600 font-medium",children:"Now"})]}),(0,b.jsx)("div",{className:"flex-1 space-y-2 min-w-0",children:0===n.length?l.length>0?(0,b.jsxs)("div",{className:"text-xs text-muted-foreground italic",children:[l.length," booking",l.length>1?"s":""," (filtered out)"]}):(0,b.jsx)("div",{className:"text-sm text-muted-foreground italic",children:"No bookings"}):n.map(a=>(0,b.jsx)(d.Card,{className:`border-l-4 ${"pending"===a.status?"border-l-yellow-500":"confirmed"===a.status?"border-l-green-500":"completed"===a.status?"border-l-blue-500":"border-l-red-500"}`,children:(0,b.jsx)(d.CardContent,{className:"p-3",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"font-semibold text-sm sm:text-base break-words",children:a.user_name}),(0,b.jsx)(f.Badge,{className:W(a.status),children:a.status})]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 break-all",children:[(0,b.jsx)(j.Mail,{className:"h-3 w-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:a.user_email})]}),a.user_phone&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(k.Phone,{className:"h-3 w-3 flex-shrink-0"}),(0,b.jsx)("a",{href:`tel:${a.user_phone}`,className:"hover:underline",children:a.user_phone})]})]}),a.notes&&(0,b.jsx)("div",{className:"mt-2 text-xs text-muted-foreground break-words",children:a.notes})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full sm:w-auto sm:min-w-[100px]",children:[(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>V(a.id),disabled:O===a.id,className:"h-7 text-xs w-full sm:w-auto",children:O===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Loader2,{className:"h-3 w-3 animate-spin mr-1"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u,{className:"h-3 w-3 mr-1"}),"Notify"]})}),"pending"===a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Button,{size:"sm",onClick:()=>U(a.id,"confirmed"),disabled:M===a.id,className:"h-7 text-xs w-full sm:w-auto",children:M===a.id?(0,b.jsx)(t.Loader2,{className:"h-3 w-3 animate-spin"}):"Confirm"}),(0,b.jsx)(e.Button,{size:"sm",variant:"destructive",onClick:()=>U(a.id,"cancelled"),disabled:M===a.id,className:"h-7 text-xs w-full sm:w-auto",children:"Cancel"})]}),"confirmed"===a.status&&(0,b.jsx)(e.Button,{size:"sm",onClick:()=>U(a.id,"completed"),disabled:M===a.id,className:"h-7 text-xs w-full sm:w-auto",children:"Complete"})]})]})})},a.id))})]})},c)})})]})})})}),(0,b.jsx)(A.TabsContent,{value:"list",className:"mt-6",children:0===X.length?(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"py-12 text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:0===G.length?"No bookings for this date":"No bookings match your search criteria"})})}):(0,b.jsx)("div",{className:"space-y-4",children:X.map(a=>(0,b.jsx)(d.Card,{className:"border-l-4 border-l-primary",children:(0,b.jsx)(d.CardContent,{className:"p-4 sm:p-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-4 min-w-0",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-lg sm:text-xl font-semibold",children:[(0,b.jsx)(h.Clock,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),a.appointment_time]}),(0,b.jsx)(f.Badge,{className:W(a.status),children:a.status})]}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.User,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,b.jsx)("span",{className:"font-medium break-words",children:a.user_name})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,b.jsx)(j.Mail,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,b.jsx)("a",{href:`mailto:${a.user_email}`,className:"hover:underline text-primary truncate",children:a.user_email})]}),a.user_phone&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Phone,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,b.jsx)("a",{href:`tel:${a.user_phone}`,className:"hover:underline text-primary",children:a.user_phone})]})]}),a.notes&&(0,b.jsxs)("div",{className:"rounded-lg bg-muted p-3 sm:p-4",children:[(0,b.jsx)("p",{className:"mb-1 text-sm font-medium",children:"Notes:"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground break-words",children:a.notes})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 lg:min-w-[200px]",children:[(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>V(a.id),disabled:O===a.id,className:"w-full gap-2",children:O===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Loader2,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u,{className:"h-4 w-4"}),"Notify Customer"]})}),"pending"===a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(e.Button,{size:"sm",onClick:()=>U(a.id,"confirmed"),disabled:M===a.id,className:"w-full gap-2",children:[M===a.id?(0,b.jsx)(t.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(r.CheckCircle2,{className:"h-4 w-4"}),"Confirm"]}),(0,b.jsxs)(e.Button,{size:"sm",variant:"destructive",onClick:()=>U(a.id,"cancelled"),disabled:M===a.id,className:"w-full gap-2",children:[M===a.id?(0,b.jsx)(t.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(s,{className:"h-4 w-4"}),"Cancel"]})]}),"confirmed"===a.status&&(0,b.jsxs)(e.Button,{size:"sm",onClick:()=>U(a.id,"completed"),disabled:M===a.id,className:"w-full gap-2",children:[M===a.id?(0,b.jsx)(t.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(r.CheckCircle2,{className:"h-4 w-4"}),"Mark as Completed"]}),("completed"===a.status||"cancelled"===a.status)&&(0,b.jsx)("div",{className:"rounded-lg bg-muted p-3 text-center text-sm text-muted-foreground",children:"completed"===a.status?"This booking has been completed":"This booking has been cancelled"})]})]})})},a.id))})})]})]})}a.s(["TimetablePage",()=>C],45117)}];

//# sourceMappingURL=components_timetable-page_tsx_1a43266f._.js.map