{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/ss/Downloads/ai-repair-diagnosis-saas-main/app/api/validate-vat/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\n\nexport async function POST(request: Request) {\n  try {\n    const { vatNumber, countryCode } = await request.json()\n\n    if (!vatNumber || !countryCode) {\n      return NextResponse.json({ error: \"VAT number and country code are required\" }, { status: 400 })\n    }\n\n    // Clean VAT number (remove spaces, dashes, etc.)\n    const cleanVatNumber = vatNumber.replace(/[^A-Z0-9]/gi, \"\").toUpperCase()\n    const cleanCountryCode = countryCode.toUpperCase()\n\n    console.log(\"[v0] Validating VAT:\", cleanCountryCode, cleanVatNumber)\n\n    // Call EU VIES VAT validation service\n    const viesUrl = \"https://ec.europa.eu/taxation_customs/vies/rest-api/ms/\" + \n                    `${cleanCountryCode}/vat/${cleanVatNumber}`\n\n    const response = await fetch(viesUrl, {\n      method: \"GET\",\n      headers: {\n        \"Accept\": \"application/json\",\n      },\n    })\n\n    if (!response.ok) {\n      console.error(\"[v0] VIES API error:\", response.status, response.statusText)\n      return NextResponse.json(\n        { \n          valid: false, \n          error: \"Unable to validate VAT number. Please check the number and try again.\" \n        },\n        { status: 200 }\n      )\n    }\n\n    const data = await response.json()\n    console.log(\"[v0] VIES response:\", data)\n\n    // VIES API response structure\n    const isValid = data.isValid === true\n\n    return NextResponse.json({\n      valid: isValid,\n      countryCode: data.countryCode || cleanCountryCode,\n      vatNumber: data.vatNumber || cleanVatNumber,\n      name: data.name || null,\n      address: data.address || null,\n      requestDate: data.requestDate || new Date().toISOString(),\n    })\n  } catch (error) {\n    console.error(\"[v0] VAT validation error:\", error)\n    return NextResponse.json(\n      { \n        valid: false, \n        error: \"VAT validation service temporarily unavailable. You can still save and validate later.\" \n      },\n      { status: 200 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,SAAS,EAAE,WAAW,EAAE,GAAG,MAAM,QAAQ,IAAI;QAErD,IAAI,CAAC,aAAa,CAAC,aAAa;YAC9B,OAAO,uTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2C,GAAG;gBAAE,QAAQ;YAAI;QAChG;QAEA,iDAAiD;QACjD,MAAM,iBAAiB,UAAU,OAAO,CAAC,eAAe,IAAI,WAAW;QACvE,MAAM,mBAAmB,YAAY,WAAW;QAEhD,QAAQ,GAAG,CAAC,wBAAwB,kBAAkB;QAEtD,sCAAsC;QACtC,MAAM,UAAU,4DACA,GAAG,iBAAiB,KAAK,EAAE,gBAAgB;QAE3D,MAAM,WAAW,MAAM,MAAM,SAAS;YACpC,QAAQ;YACR,SAAS;gBACP,UAAU;YACZ;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,wBAAwB,SAAS,MAAM,EAAE,SAAS,UAAU;YAC1E,OAAO,uTAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,OAAO;YACT,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC,uBAAuB;QAEnC,8BAA8B;QAC9B,MAAM,UAAU,KAAK,OAAO,KAAK;QAEjC,OAAO,uTAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,aAAa,KAAK,WAAW,IAAI;YACjC,WAAW,KAAK,SAAS,IAAI;YAC7B,MAAM,KAAK,IAAI,IAAI;YACnB,SAAS,KAAK,OAAO,IAAI;YACzB,aAAa,KAAK,WAAW,IAAI,IAAI,OAAO,WAAW;QACzD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,uTAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}