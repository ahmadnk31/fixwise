{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/ss/Downloads/ai-repair-diagnosis-saas-main/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient as createSupabaseServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createServerClient() {\n  const cookieStore = await cookies()\n\n  return createSupabaseServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // The \"setAll\" method was called from a Server Component.\n          // This can be ignored if you have middleware refreshing\n          // user sessions.\n        }\n      },\n    },\n  })\n}\n\nexport const createClient = createServerClient\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,mTAAO;IAEjC,OAAO,IAAA,8SAA0B,sUAAoF;QACnH,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AACF;AAEO,MAAM,eAAe","debugId":null}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///Users/ss/Downloads/ai-repair-diagnosis-saas-main/lib/email.ts"],"sourcesContent":["import { Resend } from \"resend\"\n\nconst resend = new Resend(process.env.RESEND_API_KEY)\n\nexport interface BookingEmailData {\n  bookingId: string\n  userName: string\n  userEmail: string\n  shopName: string\n  shopEmail?: string\n  appointmentDate: string\n  appointmentTime: string\n  status: \"pending\" | \"confirmed\" | \"completed\" | \"cancelled\"\n  notes?: string | null\n  shopAddress?: string\n  shopPhone?: string\n}\n\nexport async function sendBookingConfirmationEmail(data: BookingEmailData) {\n  if (!process.env.RESEND_API_KEY) {\n    console.warn(\"RESEND_API_KEY not configured, skipping email\")\n    return\n  }\n\n  const fromEmail = process.env.RESEND_FROM_EMAIL || \"noreply@fixwise.com\"\n  const formattedDate = new Date(data.appointmentDate).toLocaleDateString(\"en-US\", {\n    weekday: \"long\",\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n  })\n\n  try {\n    await resend.emails.send({\n      from: fromEmail,\n      to: data.userEmail,\n      subject: `Booking ${data.status === \"confirmed\" ? \"Confirmed\" : \"Received\"} - ${data.shopName}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Booking ${data.status === \"confirmed\" ? \"Confirmed\" : \"Received\"}</title>\n          </head>\n          <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n            <div style=\"background: linear-gradient(135deg, #1A2332 0%, #2D3748 100%); padding: 30px; text-align: center; border-radius: 10px 10px 0 0;\">\n              <h1 style=\"color: #fff; margin: 0;\">FixWise</h1>\n            </div>\n            \n            <div style=\"background: #f9fafb; padding: 30px; border-radius: 0 0 10px 10px; border: 1px solid #e5e7eb;\">\n              <h2 style=\"color: #1A2332; margin-top: 0;\">\n                ${data.status === \"confirmed\" ? \"‚úÖ Booking Confirmed!\" : \"üìÖ Booking Received\"}\n              </h2>\n              \n              <p>Hello ${data.userName},</p>\n              \n              <p>\n                ${data.status === \"confirmed\" \n                  ? \"Great news! Your booking has been confirmed by the repair shop.\" \n                  : \"Your booking request has been received and is pending confirmation from the repair shop.\"}\n              </p>\n              \n              <div style=\"background: #fff; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #1A2332;\">\n                <h3 style=\"margin-top: 0; color: #1A2332;\">Booking Details</h3>\n                <p><strong>Shop:</strong> ${data.shopName}</p>\n                <p><strong>Date:</strong> ${formattedDate}</p>\n                <p><strong>Time:</strong> ${data.appointmentTime}</p>\n                ${data.shopAddress ? `<p><strong>Address:</strong> ${data.shopAddress}</p>` : \"\"}\n                ${data.shopPhone ? `<p><strong>Phone:</strong> ${data.shopPhone}</p>` : \"\"}\n                ${data.notes ? `<p><strong>Notes:</strong> ${data.notes}</p>` : \"\"}\n                <p><strong>Status:</strong> <span style=\"text-transform: capitalize; font-weight: bold; color: ${\n                  data.status === \"confirmed\" ? \"#10b981\" : \n                  data.status === \"completed\" ? \"#3b82f6\" : \n                  data.status === \"cancelled\" ? \"#ef4444\" : \"#f59e0b\"\n                };\">${data.status}</span></p>\n              </div>\n              \n              ${data.status === \"pending\" ? `\n                <p style=\"color: #6b7280; font-size: 14px;\">\n                  You will receive another email once the shop confirms your booking.\n                </p>\n              ` : \"\"}\n              \n              ${data.status === \"confirmed\" ? `\n                <p style=\"color: #059669; font-weight: bold;\">\n                  Please arrive on time for your appointment. If you need to reschedule or cancel, please contact the shop directly.\n                </p>\n              ` : \"\"}\n              \n              <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; text-align: center; color: #6b7280; font-size: 12px;\">\n                <p>This is an automated email from FixWise. Please do not reply to this email.</p>\n                <p>If you have questions, please contact ${data.shopEmail || \"the repair shop\"} directly.</p>\n              </div>\n            </div>\n          </body>\n        </html>\n      `,\n    })\n\n    // Also send notification to shop owner if email is available\n    if (data.shopEmail && data.status === \"pending\") {\n      await resend.emails.send({\n        from: fromEmail,\n        to: data.shopEmail,\n        subject: `New Booking Request - ${data.userName}`,\n        html: `\n          <!DOCTYPE html>\n          <html>\n            <head>\n              <meta charset=\"utf-8\">\n              <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n              <title>New Booking Request</title>\n            </head>\n            <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n              <div style=\"background: linear-gradient(135deg, #1A2332 0%, #2D3748 100%); padding: 30px; text-align: center; border-radius: 10px 10px 0 0;\">\n                <h1 style=\"color: #fff; margin: 0;\">FixWise</h1>\n              </div>\n              \n              <div style=\"background: #f9fafb; padding: 30px; border-radius: 0 0 10px 10px; border: 1px solid #e5e7eb;\">\n                <h2 style=\"color: #1A2332; margin-top: 0;\">üìÖ New Booking Request</h2>\n                \n                <p>Hello,</p>\n                \n                <p>You have received a new booking request for <strong>${data.shopName}</strong>.</p>\n                \n                <div style=\"background: #fff; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #1A2332;\">\n                  <h3 style=\"margin-top: 0; color: #1A2332;\">Booking Details</h3>\n                  <p><strong>Customer:</strong> ${data.userName}</p>\n                  <p><strong>Email:</strong> ${data.userEmail}</p>\n                  <p><strong>Date:</strong> ${formattedDate}</p>\n                  <p><strong>Time:</strong> ${data.appointmentTime}</p>\n                  ${data.notes ? `<p><strong>Notes:</strong> ${data.notes}</p>` : \"\"}\n                  <p><strong>Status:</strong> <span style=\"text-transform: capitalize; font-weight: bold; color: #f59e0b;\">Pending</span></p>\n                </div>\n                \n                <p style=\"color: #059669; font-weight: bold;\">\n                  Please log in to your dashboard to confirm or manage this booking.\n                </p>\n                \n                <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; text-align: center; color: #6b7280; font-size: 12px;\">\n                  <p>This is an automated email from FixWise.</p>\n                </div>\n              </div>\n            </body>\n          </html>\n        `,\n      })\n    }\n  } catch (error) {\n    console.error(\"Error sending booking email:\", error)\n    // Don't throw - email failures shouldn't break the booking process\n  }\n}\n\nexport async function sendBookingStatusUpdateEmail(data: BookingEmailData) {\n  if (!process.env.RESEND_API_KEY) {\n    console.warn(\"RESEND_API_KEY not configured, skipping email\")\n    return\n  }\n\n  const fromEmail = process.env.RESEND_FROM_EMAIL || \"noreply@fixwise.com\"\n  const formattedDate = new Date(data.appointmentDate).toLocaleDateString(\"en-US\", {\n    weekday: \"long\",\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n  })\n\n  const statusMessages: Record<string, { subject: string; message: string; color: string }> = {\n    confirmed: {\n      subject: \"Booking Confirmed\",\n      message: \"Great news! Your booking has been confirmed.\",\n      color: \"#10b981\",\n    },\n    cancelled: {\n      subject: \"Booking Cancelled\",\n      message: \"Your booking has been cancelled.\",\n      color: \"#ef4444\",\n    },\n    completed: {\n      subject: \"Booking Completed\",\n      message: \"Your booking has been marked as completed.\",\n      color: \"#3b82f6\",\n    },\n  }\n\n  const statusInfo = statusMessages[data.status] || {\n    subject: \"Booking Status Updated\",\n    message: \"Your booking status has been updated.\",\n    color: \"#6b7280\",\n  }\n\n  try {\n    await resend.emails.send({\n      from: fromEmail,\n      to: data.userEmail,\n      subject: `${statusInfo.subject} - ${data.shopName}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>${statusInfo.subject}</title>\n          </head>\n          <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n            <div style=\"background: linear-gradient(135deg, #1A2332 0%, #2D3748 100%); padding: 30px; text-align: center; border-radius: 10px 10px 0 0;\">\n              <h1 style=\"color: #fff; margin: 0;\">FixWise</h1>\n            </div>\n            \n            <div style=\"background: #f9fafb; padding: 30px; border-radius: 0 0 10px 10px; border: 1px solid #e5e7eb;\">\n              <h2 style=\"color: #1A2332; margin-top: 0;\">\n                ${data.status === \"confirmed\" ? \"‚úÖ Booking Confirmed!\" : \n                  data.status === \"cancelled\" ? \"‚ùå Booking Cancelled\" : \n                  \"‚úÖ Booking Completed\"}\n              </h2>\n              \n              <p>Hello ${data.userName},</p>\n              \n              <p>${statusInfo.message}</p>\n              \n              <div style=\"background: #fff; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid ${statusInfo.color};\">\n                <h3 style=\"margin-top: 0; color: #1A2332;\">Booking Details</h3>\n                <p><strong>Shop:</strong> ${data.shopName}</p>\n                <p><strong>Date:</strong> ${formattedDate}</p>\n                <p><strong>Time:</strong> ${data.appointmentTime}</p>\n                <p><strong>Status:</strong> <span style=\"text-transform: capitalize; font-weight: bold; color: ${statusInfo.color};\">${data.status}</span></p>\n              </div>\n              \n              ${data.status === \"confirmed\" ? `\n                <p style=\"color: #059669; font-weight: bold;\">\n                  Please arrive on time for your appointment. If you need to reschedule or cancel, please contact the shop directly.\n                </p>\n              ` : data.status === \"cancelled\" ? `\n                <p style=\"color: #6b7280;\">\n                  If you need to book a new appointment, please visit our website or contact the shop directly.\n                </p>\n              ` : \"\"}\n              \n              <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; text-align: center; color: #6b7280; font-size: 12px;\">\n                <p>This is an automated email from FixWise. Please do not reply to this email.</p>\n                <p>If you have questions, please contact ${data.shopEmail || \"the repair shop\"} directly.</p>\n              </div>\n            </div>\n          </body>\n        </html>\n      `,\n    })\n  } catch (error) {\n    console.error(\"Error sending status update email:\", error)\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 313, "column": 0}, "map": {"version":3,"sources":["file:///Users/ss/Downloads/ai-repair-diagnosis-saas-main/app/api/bookings/%5Bid%5D/route.ts"],"sourcesContent":["import { createServerClient } from \"@/lib/supabase/server\"\nimport { type NextRequest, NextResponse } from \"next/server\"\nimport { sendBookingStatusUpdateEmail, sendBookingConfirmationEmail } from \"@/lib/email\"\n\nexport async function PATCH(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const supabase = await createServerClient()\n    const { id } = await params\n\n    // Check authentication\n    const {\n      data: { user },\n    } = await supabase.auth.getUser()\n\n    if (!user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { status, notes, appointment_date, appointment_time } = body\n\n    // Validate status if provided\n    if (status && ![\"pending\", \"confirmed\", \"completed\", \"cancelled\"].includes(status)) {\n      return NextResponse.json({ error: \"Invalid status\" }, { status: 400 })\n    }\n\n    // Validate date format if provided\n    if (appointment_date && !/^\\d{4}-\\d{2}-\\d{2}$/.test(appointment_date)) {\n      return NextResponse.json({ error: \"Invalid date format. Use YYYY-MM-DD\" }, { status: 400 })\n    }\n\n    // Validate time format if provided\n    if (appointment_time && !/^\\d{2}:\\d{2}$/.test(appointment_time)) {\n      return NextResponse.json({ error: \"Invalid time format. Use HH:MM\" }, { status: 400 })\n    }\n\n    // Fetch current booking to get shop details\n    const { data: currentBooking } = await supabase\n      .from(\"bookings\")\n      .select(`\n        *,\n        shop:repair_shops(name, email, phone, address)\n      `)\n      .eq(\"id\", id)\n      .single()\n\n    if (!currentBooking) {\n      return NextResponse.json({ error: \"Booking not found or unauthorized\" }, { status: 404 })\n    }\n\n    const shopId = (currentBooking as any).shop_id\n\n    // If date/time is being updated, check for conflicts\n    if (appointment_date || appointment_time) {\n      const newDate = appointment_date || currentBooking.appointment_date\n      const newTime = appointment_time || currentBooking.appointment_time\n\n      // Check for existing bookings at the same time slot\n      const { data: conflictingBookings } = await supabase\n        .from(\"bookings\")\n        .select(\"id\")\n        .eq(\"shop_id\", shopId)\n        .eq(\"appointment_date\", newDate)\n        .eq(\"appointment_time\", newTime)\n        .neq(\"id\", id)\n\n      if (conflictingBookings && conflictingBookings.length > 0) {\n        // Check shop preferences for max bookings per slot\n        const { data: shop } = await supabase\n          .from(\"repair_shops\")\n          .select(\"booking_preferences\")\n          .eq(\"id\", shopId)\n          .single()\n\n        const prefs = shop?.booking_preferences || { max_bookings_per_slot: 1 }\n        const maxPerSlot = prefs.max_bookings_per_slot || 1\n\n        if (conflictingBookings.length >= maxPerSlot) {\n          return NextResponse.json(\n            { error: `This time slot is already full (max ${maxPerSlot} booking${maxPerSlot > 1 ? 's' : ''} per slot)` },\n            { status: 400 }\n          )\n        }\n      }\n    }\n\n    // Update booking (RLS will ensure proper permissions)\n    const { data: booking, error } = await supabase\n      .from(\"bookings\")\n      .update({\n        ...(status && { status }),\n        ...(notes !== undefined && { notes }),\n        ...(appointment_date && { appointment_date }),\n        ...(appointment_time && { appointment_time }),\n      })\n      .eq(\"id\", id)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    if (!booking) {\n      return NextResponse.json({ error: \"Booking not found or unauthorized\" }, { status: 404 })\n    }\n\n    // Send email notification if status changed\n    if (status && status !== currentBooking.status) {\n      const shop = currentBooking.shop as any\n      \n      if (status === \"pending\") {\n        // New booking notification\n        sendBookingConfirmationEmail({\n          bookingId: booking.id,\n          userName: booking.user_name,\n          userEmail: booking.user_email,\n          shopName: shop?.name || \"Repair Shop\",\n          shopEmail: shop?.email,\n          shopAddress: shop?.address,\n          shopPhone: shop?.phone,\n          appointmentDate: booking.appointment_date,\n          appointmentTime: booking.appointment_time,\n          status: booking.status,\n          notes: booking.notes || null,\n        }).catch((err) => {\n          console.error(\"Failed to send booking email:\", err)\n        })\n      } else {\n        // Status update notification\n        sendBookingStatusUpdateEmail({\n          bookingId: booking.id,\n          userName: booking.user_name,\n          userEmail: booking.user_email,\n          shopName: shop?.name || \"Repair Shop\",\n          shopEmail: shop?.email,\n          shopAddress: shop?.address,\n          shopPhone: shop?.phone,\n          appointmentDate: booking.appointment_date,\n          appointmentTime: booking.appointment_time,\n          status: booking.status,\n          notes: booking.notes || null,\n        }).catch((err) => {\n          console.error(\"Failed to send status update email:\", err)\n        })\n      }\n    }\n\n    return NextResponse.json({ booking })\n  } catch (error) {\n    console.error(\"Error updating booking:\", error)\n    return NextResponse.json({ error: \"Failed to update booking\" }, { status: 500 })\n  }\n}\n\nexport async function DELETE(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const supabase = await createServerClient()\n    const { id } = await params\n\n    // Check authentication\n    const {\n      data: { user },\n    } = await supabase.auth.getUser()\n\n    if (!user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    // Delete booking (RLS will ensure proper permissions)\n    const { error } = await supabase.from(\"bookings\").delete().eq(\"id\", id)\n\n    if (error) throw error\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"Error deleting booking:\", error)\n    return NextResponse.json({ error: \"Failed to delete booking\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}