{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/ss/Downloads/ai-repair-diagnosis-saas-main/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient as createSupabaseServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createServerClient() {\n  const cookieStore = await cookies()\n\n  return createSupabaseServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // The \"setAll\" method was called from a Server Component.\n          // This can be ignored if you have middleware refreshing\n          // user sessions.\n        }\n      },\n    },\n  })\n}\n\nexport const createClient = createServerClient\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,mTAAO;IAEjC,OAAO,IAAA,8SAA0B,sUAAoF;QACnH,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AACF;AAEO,MAAM,eAAe","debugId":null}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///Users/ss/Downloads/ai-repair-diagnosis-saas-main/app/api/diagnose/route.ts"],"sourcesContent":["import { generateText } from \"ai\"\nimport { createClient } from \"@/lib/supabase/server\"\nimport { NextResponse } from \"next/server\"\nimport { createOpenAI } from \"@ai-sdk/openai\";\nexport const maxDuration = 30\nconst openai = createOpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n})\nexport async function POST(req: Request) {\n  try {\n    const formData = await req.formData()\n    const issue = formData.get(\"issue\") as string\n    const image = formData.get(\"image\") as File | null\n\n    if (!issue) {\n      return NextResponse.json({ error: \"Issue description is required\" }, { status: 400 })\n    }\n\n    let photoUrl: string | null = null\n    const supabase = await createClient()\n\n    // Get authenticated user (if any)\n    const {\n      data: { user },\n    } = await supabase.auth.getUser()\n\n    if (image) {\n      const fileExt = image.name.split(\".\").pop()\n      const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`\n      const filePath = `diagnoses/${fileName}`\n\n      const { data: uploadData, error: uploadError } = await supabase.storage\n        .from(\"diagnosis-images\")\n        .upload(filePath, image, {\n          contentType: image.type,\n          cacheControl: \"3600\",\n        })\n\n      if (uploadError) {\n        console.error(\"Image upload error:\", uploadError)\n      } else {\n        const {\n          data: { publicUrl },\n        } = supabase.storage.from(\"diagnosis-images\").getPublicUrl(filePath)\n        photoUrl = publicUrl\n      }\n    }\n\n    const prompt = `You are an expert electronics repair technician.\nThe user will describe a device issue (phone, laptop, tablet, etc.).\nYour goal:\n1. Identify the device brand (e.g., \"iPhone\", \"Samsung\", \"OnePlus\", \"MacBook\", \"Dell\", \"HP\")\n2. Identify the device type and model if possible (e.g., \"iPhone 12\", \"OnePlus 12\", \"MacBook Pro 2020\", \"Samsung Galaxy S21\", \"Samsung A35\")\n3. Identify the device category - this is CRITICAL for matching with repair shops. Categories include:\n   - \"smartphone\" or \"mobile phone\" or \"phone\" (for any phone: iPhone, Samsung Galaxy, OnePlus, etc.)\n   - \"tablet\" or \"iPad\" (for tablets)\n   - \"laptop\" or \"notebook\" (for laptops)\n   - \"desktop\" or \"PC\" (for desktop computers)\n   - \"smartwatch\" or \"watch\" (for smartwatches)\n   - \"gaming console\" (for PlayStation, Xbox, Nintendo Switch, etc.)\n   - \"headphones\" or \"earbuds\" (for audio devices)\n   - \"camera\" (for cameras)\n   - \"other\" (for anything else)\n4. Identify the specific component or part that needs repair (e.g., \"screen\", \"display\", \"camera\", \"battery\", \"charging port\", \"speaker\", \"microphone\")\n5. Identify the most likely cause of the problem.\n6. Estimate the repair difficulty (1â€“5, where 1 is easiest and 5 is most difficult).\n7. Suggest whether the user can fix it or needs a professional.\n8. Provide a rough cost range ($).\n9. Respond in this JSON format:\n{\n  \"device_brand\": \"device brand name (e.g., iPhone, Samsung, OnePlus, MacBook, Dell)\",\n  \"device_type\": \"exact device model (e.g., iPhone 12, OnePlus 12, MacBook Pro 2020, Samsung A35)\",\n  \"device_category\": \"device category (smartphone, tablet, laptop, desktop, smartwatch, gaming console, headphones, camera, or other)\",\n  \"repair_component\": \"specific part that needs repair (e.g., screen, display, camera, battery)\",\n  \"repair_keywords\": [\"alternative\", \"keywords\", \"for\", \"matching\", \"e.g.\", \"screen\", \"display\", \"lcd\", \"oled\"],\n  \"probable_issue\": \"description of the issue\",\n  \"likely_cause\": \"what caused the problem\",\n  \"repair_difficulty\": \"1-5\",\n  \"recommended_action\": \"DIY or Professional\",\n  \"estimated_cost\": \"$X-$Y\"\n}\n\nImportant: \n- Extract the brand name separately (OnePlus, iPhone, Samsung, etc.)\n- The device_category is CRITICAL - if user says \"Samsung A35\" or \"iPhone 12\" or \"OnePlus 12\", the category should be \"smartphone\"\n- If user says \"iPad\" or \"Samsung tablet\", category should be \"tablet\"\n- If user says \"MacBook\" or \"Dell laptop\", category should be \"laptop\"\n- Include alternative keywords for the repair component (e.g., for \"screen\" also include \"display\", \"LCD\", \"OLED\")\n- Use common repair terminology that shops might use\n- The device_category will be used to match shops with expertise like \"smartphone\", \"mobile phone\", \"phone\", \"tablet\", \"laptop\", etc.\n\nUser's issue: ${issue}`\n\n    // Call OpenAI for diagnosis\n    const { text } = await generateText({\n      model: openai(\"gpt-4o-mini\"),\n      prompt,\n      maxOutputTokens: 500,\n    })\n\n    // Parse the AI response\n    let diagnosis\n    try {\n      // Extract JSON from the response (in case there's extra text)\n      const jsonMatch = text.match(/\\{[\\s\\S]*\\}/)\n      if (jsonMatch) {\n        diagnosis = JSON.parse(jsonMatch[0])\n      } else {\n        throw new Error(\"No JSON found in response\")\n      }\n    } catch (parseError) {\n      console.error(\"Failed to parse AI response:\", text)\n      return NextResponse.json({ error: \"Failed to parse diagnosis\" }, { status: 500 })\n    }\n\n    // Save diagnosis to database\n    const { data: diagnosisData, error: dbError } = await supabase\n      .from(\"diagnoses\")\n      .insert({\n        user_id: user?.id || null,\n        user_input: issue,\n        ai_response: diagnosis,\n        estimated_cost: diagnosis.estimated_cost,\n        photo_url: photoUrl,\n      })\n      .select()\n      .single()\n\n    if (dbError) {\n      console.error(\"Database error:\", dbError)\n      return NextResponse.json({ error: \"Failed to save diagnosis\" }, { status: 500 })\n    }\n\n    return NextResponse.json({\n      diagnosis,\n      diagnosisId: diagnosisData.id,\n    })\n  } catch (error) {\n    console.error(\"Diagnosis error:\", error)\n    return NextResponse.json({ error: \"Failed to process diagnosis\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AACO,MAAM,cAAc;AAC3B,MAAM,SAAS,IAAA,iQAAY,EAAC;IAC1B,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AACO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,QAAQ,SAAS,GAAG,CAAC;QAC3B,MAAM,QAAQ,SAAS,GAAG,CAAC;QAE3B,IAAI,CAAC,OAAO;YACV,OAAO,uTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgC,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,IAAI,WAA0B;QAC9B,MAAM,WAAW,MAAM,IAAA,2IAAY;QAEnC,kCAAkC;QAClC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,OAAO;YACT,MAAM,UAAU,MAAM,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;YACzC,MAAM,WAAW,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE,SAAS;YACtF,MAAM,WAAW,CAAC,UAAU,EAAE,UAAU;YAExC,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,OAAO,CACpE,IAAI,CAAC,oBACL,MAAM,CAAC,UAAU,OAAO;gBACvB,aAAa,MAAM,IAAI;gBACvB,cAAc;YAChB;YAEF,IAAI,aAAa;gBACf,QAAQ,KAAK,CAAC,uBAAuB;YACvC,OAAO;gBACL,MAAM,EACJ,MAAM,EAAE,SAAS,EAAE,EACpB,GAAG,SAAS,OAAO,CAAC,IAAI,CAAC,oBAAoB,YAAY,CAAC;gBAC3D,WAAW;YACb;QACF;QAEA,MAAM,SAAS,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;cA2CN,EAAE,OAAO;QAEnB,4BAA4B;QAC5B,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,2OAAY,EAAC;YAClC,OAAO,OAAO;YACd;YACA,iBAAiB;QACnB;QAEA,wBAAwB;QACxB,IAAI;QACJ,IAAI;YACF,8DAA8D;YAC9D,MAAM,YAAY,KAAK,KAAK,CAAC;YAC7B,IAAI,WAAW;gBACb,YAAY,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;YACrC,OAAO;gBACL,MAAM,IAAI,MAAM;YAClB;QACF,EAAE,OAAO,YAAY;YACnB,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO,uTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,6BAA6B;QAC7B,MAAM,EAAE,MAAM,aAAa,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,SACnD,IAAI,CAAC,aACL,MAAM,CAAC;YACN,SAAS,MAAM,MAAM;YACrB,YAAY;YACZ,aAAa;YACb,gBAAgB,UAAU,cAAc;YACxC,WAAW;QACb,GACC,MAAM,GACN,MAAM;QAET,IAAI,SAAS;YACX,QAAQ,KAAK,CAAC,mBAAmB;YACjC,OAAO,uTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,OAAO,uTAAY,CAAC,IAAI,CAAC;YACvB;YACA,aAAa,cAAc,EAAE;QAC/B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,uTAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF","debugId":null}}]
}