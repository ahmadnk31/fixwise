{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/ss/Downloads/ai-repair-diagnosis-saas-main/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient as createSupabaseServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createServerClient() {\n  const cookieStore = await cookies()\n\n  return createSupabaseServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // The \"setAll\" method was called from a Server Component.\n          // This can be ignored if you have middleware refreshing\n          // user sessions.\n        }\n      },\n    },\n  })\n}\n\nexport const createClient = createServerClient\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,mTAAO;IAEjC,OAAO,IAAA,8SAA0B,sUAAoF;QACnH,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AACF;AAEO,MAAM,eAAe","debugId":null}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///Users/ss/Downloads/ai-repair-diagnosis-saas-main/app/api/bookings/available-slots/route.ts"],"sourcesContent":["import { createServerClient } from \"@/lib/supabase/server\"\nimport { type NextRequest, NextResponse } from \"next/server\"\n\nfunction generateTimeSlots(startTime: string, endTime: string, slotDuration: number): string[] {\n  const slots: string[] = []\n  const [startHour, startMin] = startTime.split(\":\").map(Number)\n  const [endHour, endMin] = endTime.split(\":\").map(Number)\n  \n  let currentHour = startHour\n  let currentMin = startMin\n  \n  while (currentHour < endHour || (currentHour === endHour && currentMin < endMin)) {\n    slots.push(`${currentHour.toString().padStart(2, \"0\")}:${currentMin.toString().padStart(2, \"0\")}`)\n    currentMin += slotDuration\n    if (currentMin >= 60) {\n      currentMin = 0\n      currentHour++\n    }\n  }\n  \n  return slots\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createServerClient()\n    const searchParams = request.nextUrl.searchParams\n    const shopId = searchParams.get(\"shop_id\")\n    const date = searchParams.get(\"date\")\n\n    if (!shopId || !date) {\n      return NextResponse.json({ error: \"shop_id and date are required\" }, { status: 400 })\n    }\n\n    // Fetch shop with booking preferences\n    const { data: shop, error: shopError } = await supabase\n      .from(\"repair_shops\")\n      .select(\"id, booking_preferences\")\n      .eq(\"id\", shopId)\n      .single()\n\n    if (shopError || !shop) {\n      return NextResponse.json({ error: \"Shop not found\" }, { status: 404 })\n    }\n\n    // Get booking preferences with defaults\n    const prefs = shop.booking_preferences || {\n      max_bookings_per_day: 10,\n      max_bookings_per_slot: 1,\n      working_hours: { start: \"09:00\", end: \"17:00\" },\n      slot_duration_minutes: 30,\n      buffer_time_minutes: 15,\n      advance_booking_days: 30,\n      same_day_booking_allowed: true,\n    }\n\n    // Check if date is valid\n    const today = new Date().toISOString().split(\"T\")[0]\n    if (date === today && !prefs.same_day_booking_allowed) {\n      return NextResponse.json({ availableSlots: [], message: \"Same-day bookings are not allowed\" })\n    }\n\n    // Check daily booking limit\n    const { data: dayBookings } = await supabase\n      .from(\"bookings\")\n      .select(\"appointment_time\")\n      .eq(\"shop_id\", shopId)\n      .eq(\"appointment_date\", date)\n      .in(\"status\", [\"pending\", \"confirmed\"])\n\n    const bookingsCount = dayBookings?.length || 0\n    if (bookingsCount >= (prefs.max_bookings_per_day || 10)) {\n      return NextResponse.json({ availableSlots: [], message: \"Daily booking limit reached\" })\n    }\n\n    // Generate all time slots\n    const workStart = prefs.working_hours?.start || \"09:00\"\n    const workEnd = prefs.working_hours?.end || \"17:00\"\n    const slotDuration = prefs.slot_duration_minutes || 30\n    const allSlots = generateTimeSlots(workStart, workEnd, slotDuration)\n\n    // Get booked slots\n    const bookedSlots = dayBookings?.map((b: any) => b.appointment_time) || []\n    const maxPerSlot = prefs.max_bookings_per_slot || 1\n\n    // Count bookings per slot\n    const slotCounts: Record<string, number> = {}\n    bookedSlots.forEach((slot: string) => {\n      slotCounts[slot] = (slotCounts[slot] || 0) + 1\n    })\n\n    // Filter available slots\n    const availableSlots = allSlots.filter((slot) => {\n      const count = slotCounts[slot] || 0\n      return count < maxPerSlot\n    })\n\n    return NextResponse.json({\n      availableSlots,\n      totalSlots: allSlots.length,\n      bookedSlots: bookedSlots.length,\n      availableCount: availableSlots.length,\n      dailyLimit: prefs.max_bookings_per_day,\n      remainingDailyCapacity: (prefs.max_bookings_per_day || 10) - bookingsCount,\n      advance_booking_days: prefs.advance_booking_days,\n      same_day_booking_allowed: prefs.same_day_booking_allowed,\n      require_phone: prefs.require_phone || false,\n      workingHours: prefs.working_hours || { start: \"09:00\", end: \"17:00\" },\n      slotDuration: prefs.slot_duration_minutes || 30,\n      maxBookingsPerSlot: prefs.max_bookings_per_slot || 1,\n    })\n  } catch (error) {\n    console.error(\"Error fetching available slots:\", error)\n    return NextResponse.json({ error: \"Failed to fetch available slots\" }, { status: 500 })\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}